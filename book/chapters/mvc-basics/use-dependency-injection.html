
<!DOCTYPE HTML>
<html lang="zh-hans" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>运用依赖注入 · 简明 ASP.NET Core 手册</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        <meta name="author" content="Nate Barbettini">
        
        
    
    <link rel="stylesheet" href="../../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-expandable-chapters-small/expandable-chapters-small.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-disqus/plugin.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-splitter/splitter.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-anchors/plugin.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-forkmegithub/plugin.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="finish-controller.html" />
    
    
    <link rel="prev" href="add-service-class.html" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="输入并搜索" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="../../">
            
                <a href="../../">
            
                    
                    Introduction
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="../your-first-application/">
            
                <a href="../your-first-application/">
            
                    
                    你的第一个程序
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.1" data-path="../your-first-application/get-the-sdk.html">
            
                <a href="../your-first-application/get-the-sdk.html">
            
                    
                    获取 SDK
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.2" data-path="../your-first-application/hello-world-in-csharp.html">
            
                <a href="../your-first-application/hello-world-in-csharp.html">
            
                    
                    C# 版的 Hello World
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.3" data-path="../your-first-application/create-aspnetcore-project.html">
            
                <a href="../your-first-application/create-aspnetcore-project.html">
            
                    
                    创建一个 ASP.NET Core 项目
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3" data-path="./">
            
                <a href="./">
            
                    
                    MVC 基础
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.1" data-path="create-controller.html">
            
                <a href="create-controller.html">
            
                    
                    创建控制器
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2" data-path="create-models.html">
            
                <a href="create-models.html">
            
                    
                    创建模型
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.3" data-path="create-view.html">
            
                <a href="create-view.html">
            
                    
                    创建视图
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.4" data-path="add-service-class.html">
            
                <a href="add-service-class.html">
            
                    
                    添加一个服务类
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="1.3.5" data-path="use-dependency-injection.html">
            
                <a href="use-dependency-injection.html">
            
                    
                    运用依赖注入
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.6" data-path="finish-controller.html">
            
                <a href="finish-controller.html">
            
                    
                    完成控制器
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.7" data-path="update-the-layout.html">
            
                <a href="update-the-layout.html">
            
                    
                    修改布局
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.4" data-path="../add-external-packages/">
            
                <a href="../add-external-packages/">
            
                    
                    添加外来软件包
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5" data-path="../use-a-database/">
            
                <a href="../use-a-database/">
            
                    
                    运用数据库
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.1" data-path="../use-a-database/connect-to-a-database.html">
            
                <a href="../use-a-database/connect-to-a-database.html">
            
                    
                    连接数据库
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.2" data-path="../use-a-database/update-context.html">
            
                <a href="../use-a-database/update-context.html">
            
                    
                    修改数据库上下文
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.3" data-path="../use-a-database/create-migration.html">
            
                <a href="../use-a-database/create-migration.html">
            
                    
                    创建变更
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.4" data-path="../use-a-database/create-service-class.html">
            
                <a href="../use-a-database/create-service-class.html">
            
                    
                    创建服务类
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.6" data-path="../add-more-features/">
            
                <a href="../add-more-features/">
            
                    
                    添加新特性
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.6.1" data-path="../add-more-features/add-todo-items.html">
            
                <a href="../add-more-features/add-todo-items.html">
            
                    
                    添加 待办事项 条目
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.2" data-path="../add-more-features/complete-with-checkbox.html">
            
                <a href="../add-more-features/complete-with-checkbox.html">
            
                    
                    使用复选框标记条目完成
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.7" data-path="../security-and-identity/">
            
                <a href="../security-and-identity/">
            
                    
                    安全和身份
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.7.1" data-path="../security-and-identity/require-authentication.html">
            
                <a href="../security-and-identity/require-authentication.html">
            
                    
                    提示认证
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.2" data-path="../security-and-identity/using-identity-in-the-application.html">
            
                <a href="../security-and-identity/using-identity-in-the-application.html">
            
                    
                    在程序中使用身份
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.3" data-path="../security-and-identity/authorization-with-roles.html">
            
                <a href="../security-and-identity/authorization-with-roles.html">
            
                    
                    按角色进行授权
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.4" data-path="../security-and-identity/more-resources.html">
            
                <a href="../security-and-identity/more-resources.html">
            
                    
                    附加资源
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.8" data-path="../automated-testing/">
            
                <a href="../automated-testing/">
            
                    
                    自动化测试
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.8.1" data-path="../automated-testing/unit-testing.html">
            
                <a href="../automated-testing/unit-testing.html">
            
                    
                    单元测试
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.2" data-path="../automated-testing/integration-testing.html">
            
                <a href="../automated-testing/integration-testing.html">
            
                    
                    集成测试
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.9" data-path="../deploy-the-application/">
            
                <a href="../deploy-the-application/">
            
                    
                    部署程序
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.9.1" data-path="../deploy-the-application/deploy-to-azure.html">
            
                <a href="../deploy-the-application/deploy-to-azure.html">
            
                    
                    部署到 Azure
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.2" data-path="../deploy-the-application/deploy-with-docker.html">
            
                <a href="../deploy-the-application/deploy-with-docker.html">
            
                    
                    使用 Docker 进行部署
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.10" data-path="../conclusion/">
            
                <a href="../conclusion/">
            
                    
                    结束语
            
                </a>
            

            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            本书使用 GitBook 发布
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="../.." >运用依赖注入</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h2 id="&#x8FD0;&#x7528;&#x4F9D;&#x8D56;&#x6CE8;&#x5165;"><a name="&#x8FD0;&#x7528;&#x4F9D;&#x8D56;&#x6CE8;&#x5165;" class="plugin-anchor" href="#&#x8FD0;&#x7528;&#x4F9D;&#x8D56;&#x6CE8;&#x5165;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x8FD0;&#x7528;&#x4F9D;&#x8D56;&#x6CE8;&#x5165;</h2>
<p>&#x56DE;&#x5230; <code>TodoController</code>&#xFF0C;&#x6DFB;&#x52A0;&#x4E00;&#x4E9B;&#x4EE3;&#x7801;&#x4EE5;&#x4F7F;&#x7528; <code>ITodoItemService</code>:</p>
<pre><code class="lang-csharp"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">TodoController</span> : <span class="hljs-title">Controller</span>
{
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">readonly</span> ITodoItemService _todoItemService;

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">TodoController</span>(<span class="hljs-params">ITodoItemService todoItemService</span>)
    </span>{
        _todoItemService = todoItemService;
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> IActionResult <span class="hljs-title">Index</span>(<span class="hljs-params"></span>)
    </span>{
        <span class="hljs-comment">// Get to-do items from database</span>

        <span class="hljs-comment">// Put items into a model</span>

        <span class="hljs-comment">// Pass the view to a model and render</span>
    }
}
</code></pre>
<p>&#x65E2;&#x7136; <code>ITodoItemService</code> &#x5728;&#x547D;&#x540D;&#x7A7A;&#x95F4; <code>Services</code> &#x91CC;&#xFF0C;&#x4F60;&#x540C;&#x6837;&#x9700;&#x8981;&#x5728;&#x6587;&#x4EF6;&#x9876;&#x90E8;&#x6DFB;&#x52A0;&#x4E00;&#x4E2A; <code>using</code> &#x8BED;&#x53E5;&#xFF1A;</p>
<pre><code class="lang-csharp"><span class="hljs-keyword">using</span> AspNetCoreTodo.Services;
</code></pre>
<p>&#x8FD9;&#x4E2A;&#x7C7B;&#x7684;&#x7B2C;&#x4E00;&#x884C;&#x58F0;&#x660E;&#x4E86;&#x4E00;&#x4E2A;&#x79C1;&#x6709;&#x53D8;&#x91CF;&#xFF0C;&#x4FDD;&#x5B58; <code>ITodoItemService</code> &#x7684;&#x5F15;&#x7528;&#x3002;&#x8FD9;&#x4E2A;&#x53D8;&#x91CF;&#x53EF;&#x4EE5;&#x8BA9;&#x4F60;&#x5728;&#x540E;&#x9762;&#x7684; <code>Index</code> &#x65B9;&#x6CD5;&#x91CC;&#x4F7F;&#x7528;&#x8BE5;&#x670D;&#x52A1;&#xFF08;&#x5177;&#x4F53;&#x65B9;&#x6CD5;&#xFF0C;&#x7A0D;&#x540E;&#x4FBF;&#x77E5;&#xFF09;&#x3002;</p>
<p><code>public TodoController(ITodoItemService todoItemService)</code> &#x8FD9;&#x4E00;&#x884C;&#x7ED9;&#x7C7B;&#x5B9A;&#x4E49;&#x4E86;&#x4E00;&#x4E2A; <strong>&#x6784;&#x9020;&#x51FD;&#x6570;(constructor)</strong>&#x3002;&#x6784;&#x9020;&#x51FD;&#x6570;&#x662F;&#x4E00;&#x4E2A;&#x7279;&#x6B8A;&#x7684;&#x65B9;&#x6CD5;&#xFF0C;&#x5B83;&#x4F1A;&#x5728;&#x4E3A;&#xFF08;&#x672C;&#x4F8B;&#x4E2D;&#x662F; <code>TodoController</code>&#xFF09;&#x7C7B;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x65B0;&#x7684;&#x5B9E;&#x4F8B;&#x7684;&#x65F6;&#x5019;&#x88AB;&#x8C03;&#x7528;&#x3002;&#x5728;&#x6784;&#x9020;&#x51FD;&#x6570;&#x4E2D;&#x52A0;&#x5165;&#x7684; <code>ITodoItemService</code> &#x53C2;&#x6570;&#xFF0C;&#x8868;&#x793A;&#x4F60;&#x505A;&#x51FA;&#x5982;&#x4E0B;&#x58F0;&#x660E;&#xFF1A;&#x8981;&#x521B;&#x5EFA;&#x4E00;&#x4E2A; <code>TodoController</code>&#xFF0C;&#x4F60;&#x5FC5;&#x987B;&#x63D0;&#x4F9B;&#x4E00;&#x4E2A;&#x80FD;&#x5339;&#x914D; <code>ITodoItemService</code> &#x63A5;&#x53E3;&#x7684;&#x5BF9;&#x8C61;&#x3002;</p>
<blockquote>
<p>&#x63A5;&#x53E3;&#x5982;&#x6B64;&#x6709;&#x7528;&#x7684;&#x539F;&#x56E0;&#x5C31;&#x5728;&#x4E8E;&#xFF0C;&#x56E0;&#x4E3A;&#x5B83;&#x4EEC;&#x6709;&#x52A9;&#x4E8E;&#x89E3;&#x8026;&#xFF08;&#x5206;&#x79BB;&#xFF09;&#x4F60;&#x7A0B;&#x5E8F;&#x91CC;&#x7684;&#x903B;&#x8F91;&#x3002;&#x65E2;&#x7136;&#x8FD9;&#x4E2A;&#x63A7;&#x5236;&#x5668;&#x4F9D;&#x8D56;&#x4E8E; <code>ITodoItemService</code> &#x63A5;&#x53E3;&#xFF0C;&#x800C;&#x4E0D;&#x662F;&#x4EFB;&#x4F55; <em>&#x7279;&#x5B9A;&#x7684;</em> &#x7C7B;&#xFF0C;&#x5B83;&#x5C31;&#x4E0D;&#x77E5;&#x9053;&#x4E5F;&#x4E0D;&#x5FC5;&#x5173;&#x5FC3;&#x5B9E;&#x9645;&#x4F7F;&#x7528;&#x7684;&#x662F;&#x54EA;&#x4E2A;&#x5177;&#x4F53;&#x7684;&#x7C7B;&#x3002;&#x5B83;&#x53EF;&#x4EE5;&#x662F; <code>FakeTodoItemService</code>&#xFF0C;&#x6216;&#x8005;&#x662F;&#x5176;&#x5B83;&#x8BFB;&#x5199;&#x6570;&#x636E;&#x5E93;&#x7684;&#x7C7B;&#xFF0C;&#x6216;&#x8005;&#x522B;&#x7684;&#x4EC0;&#x4E48;&#x7C7B;&#x3002;&#x53EA;&#x8981;&#x5B83;&#x7B26;&#x5408;&#x8BE5;&#x63A5;&#x53E3;&#x7684;&#x8981;&#x6C42;&#xFF0C;&#x63A7;&#x5236;&#x5668;&#x5C31;&#x80FD;&#x5DE5;&#x4F5C;&#x3002;&#x8FD9;&#x4F7F;&#x4F60;&#x53EF;&#x4EE5;&#x8F7B;&#x800C;&#x6613;&#x4E3E;&#x5730;&#xFF0C;&#x72EC;&#x7ACB;&#x6D4B;&#x8BD5;&#x7A0B;&#x5E8F;&#x7684;&#x5404;&#x90E8;&#x5206;&#x3002;&#xFF08;&#x6211;&#x4F1A;&#x5728; <em>&#x81EA;&#x52A8;&#x5316;&#x6D4B;&#x8BD5;</em> &#x4E00;&#x7AE0;&#x8BB2;&#x89E3;&#x6D4B;&#x8BD5;&#x76F8;&#x5173;&#x7684;&#x5185;&#x5BB9;&#x3002;&#xFF09;</p>
</blockquote>
<p>&#x73B0;&#x5728;&#xFF0C;&#x4F60;&#x7EC8;&#x4E8E;&#x53EF;&#x4EE5;&#x5728; action &#x65B9;&#x6CD5;&#x91CC;&#xFF0C;&#xFF08;&#x901A;&#x8FC7;&#x4F60;&#x58F0;&#x660E;&#x7684;&#x90A3;&#x4E2A;&#x79C1;&#x6709;&#x53D8;&#x91CF;&#xFF09;&#x4F7F;&#x7528; <code>ITodoItemService</code> &#x4ECE;&#x670D;&#x52A1;&#x5C42;&#x83B7;&#x53D6; &#x5F85;&#x529E;&#x4E8B;&#x9879; &#x4E86;&#xFF1A;</p>
<pre><code class="lang-csharp"><span class="hljs-function"><span class="hljs-keyword">public</span> IActionResult <span class="hljs-title">Index</span>(<span class="hljs-params"></span>)
</span>{
    <span class="hljs-keyword">var</span> items = <span class="hljs-keyword">await</span> _todoItemService.GetIncompleteItemsAsync();

    <span class="hljs-comment">// ...</span>
}
</code></pre>
<p>&#x8FD8;&#x8BB0;&#x5F97;&#x5417;&#xFF1F; <code>GetIncompleteItemsAsync</code> &#x65B9;&#x6CD5;&#x8FD4;&#x56DE;&#x4E00;&#x4E2A; <code>Task&lt;TodoItem[]&gt;</code>&#x3002;&#x201C;&#x8FD4;&#x56DE;&#x4E00;&#x4E2A; <code>Task</code>&#x201D;&#x7684;&#x610F;&#x601D;&#x662F;&#x8BF4;&#xFF0C;&#x8BE5;&#x65B9;&#x6CD5;&#x4E0D;&#x80FD;&#x7ACB;&#x523B;&#x7ED9;&#x51FA;&#x4E00;&#x4E2A;&#x7ED3;&#x679C;&#xFF0C;&#x4F46;&#x662F;&#x4F60;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x5173;&#x952E;&#x5B57; <code>await</code>&#xFF0C;&#x4EE5;&#x786E;&#x4FDD;&#x4F60;&#x7684;&#x4EE3;&#x7801;&#x6682;&#x505C;&#xFF0C;&#x76F4;&#x5230;&#x7ED3;&#x679C;&#x5C31;&#x7EEA;&#x624D;&#x7EE7;&#x7EED;&#x6267;&#x884C;&#x3002;</p>
<p>&#x5F53;&#x4F60;&#x7F16;&#x5199;&#x4EE3;&#x7801;&#x8BBF;&#x95EE;&#x6570;&#x636E;&#x5E93;&#x6216;&#x8005;&#x5916;&#x90E8; API &#x670D;&#x52A1;&#x7684;&#x65F6;&#x5019;&#xFF0C;<code>Task</code> &#x6A21;&#x5F0F;&#x662F;&#x5F88;&#x5E38;&#x89C1;&#x7684;&#xFF0C;&#x56E0;&#x4E3A;&#x5728;&#x6570;&#x636E;&#x5E93;&#xFF08;&#x6216;&#x8005;&#x7F51;&#x7EDC;&#xFF09;&#x54CD;&#x5E94;&#x4E4B;&#x524D;&#xFF0C;&#x5B83;&#x4E0D;&#x53EF;&#x80FD;&#x7ED9;&#x51FA;&#x5B9E;&#x9645;&#x7684;&#x7ED3;&#x679C;&#x3002;&#x5982;&#x679C;&#x4F60;&#x5728; JavaScript &#x6216;&#x8005;&#x5176;&#x5B83;&#x8BED;&#x8A00;&#x91CC;&#x4F7F;&#x7528;&#x8FC7; promise &#x6216;&#x8005; &#x56DE;&#x8C03;&#x51FD;&#x6570;&#xFF0C;<code>Task</code> &#x4E0E;&#x4E4B;&#x5982;&#x51FA;&#x4E00;&#x8F99;&#xFF1A;&#x627F;&#x8BFA;&#x4F60;&#xFF0C;&#x80AF;&#x5B9A;&#x4F1A;&#x7ED9;&#x51FA;&#x4E00;&#x4E2A;&#x7ED3;&#x679C;&#x2014;&#x2014;&#x5728;&#x672A;&#x6765;&#x7684;&#x67D0;&#x4E2A;&#x65F6;&#x5019;&#x3002;</p>
<blockquote>
<p>&#x5982;&#x679C;&#x4F60;&#x5728;&#x8001;&#x5F0F; JavaScript &#x91CC;&#x5E94;&#x4ED8;&#x8FC7; &#x201C;&#x56DE;&#x8C03;&#x5730;&#x72F1;&#x201D;&#xFF0C;&#x90A3;&#x4F60;&#x73B0;&#x5728;&#x8D70;&#x8FD0;&#x4E86;&#x3002;&#x5728; .NET &#x91CC;&#x4F7F;&#x7528; <code>Task</code> &#x8DDF;&#x4F9D;&#x9644;&#x4EE3;&#x7801;&#x6253;&#x4EA4;&#x9053;&#x8981;&#x5BB9;&#x6613;&#x5F97;&#x591A;&#xFF0C;&#x8FD9;&#x5F52;&#x529F;&#x4E8E;&#x795E;&#x5947;&#x7684;&#x5173;&#x952E;&#x5B57; <code>await</code>&#x3002; <code>await</code> &#x628A;&#x4EE3;&#x7801;&#x6682;&#x505C;&#x5728; &#x5F02;&#x6B65;(async) &#x64CD;&#x4F5C;&#x4E0A;&#xFF0C;&#x800C;&#x540E;&#xFF0C;&#x5728;&#x5E95;&#x5C42;&#x6570;&#x636E;&#x5E93;&#x6216;&#x8005;&#x7F51;&#x7EDC;&#x8BF7;&#x6C42;&#x7ED3;&#x675F;&#x65F6;&#xFF0C;&#x4ECE;&#x6682;&#x505C;&#x7684;&#x5730;&#x65B9;&#x6062;&#x590D;&#x6267;&#x884C;&#x3002;&#x5C31;&#x662F;&#x8BF4;&#xFF0C;&#x4F60;&#x7684;&#x7A0B;&#x5E8F;&#x5E76;&#x6CA1;&#x6709;&#x5361;&#x4F4F;&#x6216;&#x8005;&#x963B;&#x585E;&#x4F4F;&#xFF0C;&#x56E0;&#x4E3A;&#x5B83;&#x53EF;&#x4EE5;&#x5904;&#x7406;&#x5176;&#x5B83;&#x7684;&#x8BF7;&#x6C42;&#x3002;&#x5982;&#x679C;&#x73B0;&#x5728;&#x60F3;&#x4E0D;&#x901A;&#x4E5F;&#x522B;&#x62C5;&#x5FC3;&#xFF0C;&#x8DDF;&#x7740;&#x505A;&#x4E0B;&#x53BB;&#x5C31;&#x884C;&#xFF01;</p>
</blockquote>
<p>&#x76EE;&#x524D;&#x7684;&#x91CD;&#x70B9;&#x5C31;&#x662F;&#x4FEE;&#x6539; <code>Index</code> &#x65B9;&#x6CD5;&#x7684;&#x7B7E;&#x540D;&#xFF0C;&#x4EE5;&#x8FD4;&#x56DE;&#x4E00;&#x4E2A; <code>Task&lt;IActionResult&gt;</code>&#xFF0C;&#x4EE3;&#x66FF;&#x4E4B;&#x524D;&#x7684; <code>IActionResult</code>&#xFF0C;&#x5E76;&#x6807;&#x8BB0;&#x4E3A; <code>async</code>&#xFF1A;</p>
<pre><code class="lang-csharp"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">async</span> Task&lt;IActionResult&gt; <span class="hljs-title">Index</span>(<span class="hljs-params"></span>)
</span>{
    <span class="hljs-keyword">var</span> items = <span class="hljs-keyword">await</span> _todoItemService.GetIncompleteItemsAsync();

    <span class="hljs-comment">// Put items into a model</span>

    <span class="hljs-comment">// Pass the view to a model and render</span>
}
</code></pre>
<p>&#x80DC;&#x5229;&#x5728;&#x671B;&#xFF01;&#x4F60;&#x5DF2;&#x7ECF;&#x8BA9; <code>TodoController</code> &#x4F9D;&#x8D56;&#x4E8E; <code>ITodoItemService</code> &#x63A5;&#x53E3;&#xFF0C;&#x4F46;&#x4F60;&#x8FD8;&#x6CA1;&#x544A;&#x8BC9; ASP.NET Core&#xFF0C;&#x4F60;&#x60F3;&#x628A; <code>FakeTodoItemService</code> &#x4F5C;&#x4E3A;&#x5E55;&#x540E;&#x7684;&#x5B9E;&#x9645;&#x670D;&#x52A1;&#x3002;&#x53EF;&#x80FD;&#x4F60;&#x89C9;&#x5F97;&#x8FD9;&#x662F;&#x7406;&#x6240;&#x5F53;&#x7136;&#x7684;&#xFF0C;&#x56E0;&#x4E3A;&#x4F60;&#x7684;<code>ITodoItemService</code>&#x4EC5;&#x6709;&#x8FD9;&#x4E00;&#x4E2A;&#x5B9E;&#x73B0;&#xFF0C;&#x4F46;&#x4F60;&#x540E;&#x9762;&#x4F1A;&#x4E3A;&#x540C;&#x4E00;&#x4E2A;&#x63A5;&#x53E3;&#x63D0;&#x4F9B;&#x591A;&#x4E2A;&#x5B9E;&#x73B0;&#xFF0C;&#x6240;&#x4EE5;&#xFF0C;&#x6709;&#x5FC5;&#x8981;&#x660E;&#x786E;&#x6307;&#x5B9A;&#x5B9E;&#x73B0;&#x3002;</p>
<p>&#x8981;&#x58F0;&#x660E;&#xFF08;&#x6216;&#x8005;&#x201C;&#x5173;&#x8054;&#x201D;&#xFF09;&#x5177;&#x4F53;&#x7684;&#x7C7B;&#x5230;&#x6BCF;&#x4E2A;&#x63A5;&#x53E3;&#x4E0A;&#xFF0C;&#x9700;&#x8981;&#x5199;&#x5728; <code>StartUp</code> &#x7C7B;&#x7684; <code>ConfigureServices</code> &#x65B9;&#x6CD5;&#x91CC;&#xFF0C;&#x5728;&#x5F53;&#x524D;&#x60C5;&#x51B5;&#x91CC;&#xFF0C;&#x5E94;&#x8BE5;&#x8FD9;&#x4E48;&#x5199;&#xFF1A;</p>
<p><strong>Startup.cs</strong></p>
<pre><code class="lang-csharp"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">ConfigureServices</span>(<span class="hljs-params">IServiceCollection services</span>)
</span>{
    <span class="hljs-comment">// (... some code)</span>

    services.AddMvc();
}
</code></pre>
<p><code>ConfigureServices</code> &#x65B9;&#x6CD5;&#x8D1F;&#x8D23;&#x7684;&#x662F;&#x628A;&#x4E1C;&#x897F;&#x6DFB;&#x52A0;&#x5230; <strong>&#x670D;&#x52A1;&#x5BB9;&#x5668;</strong> &#x91CC;&#xFF0C;&#x6216;&#x8005; ASP.NET Core &#x7684;&#x8BF4;&#x6CD5;&#x662F;&#x670D;&#x52A1;&#x7684;&#x96C6;&#x5408;&#x3002; <code>services.AddMvc</code> &#x8FD9;&#x884C;&#x6DFB;&#x52A0;&#x4E86;&#x4E00;&#x4E9B;&#x670D;&#x52A1;&#xFF0C;&#x5B83;&#x4EEC;&#x662F; ASP.NET Core &#x7CFB;&#x7EDF;&#x5185;&#x90E8;&#x4F9D;&#x8D56;&#x7684;&#xFF08;&#x4F60;&#x53EF;&#x4EE5;&#x8BD5;&#x8BD5;&#xFF0C;&#x628A;&#x8FD9;&#x884C;&#x4EE3;&#x7801;&#x6CE8;&#x91CA;&#x6389;&#xFF09;&#x3002;&#x4F60;&#x5728;&#x5E94;&#x7528;&#x91CC;&#x6240;&#x9700;&#x7684;&#x4EFB;&#x4F55;&#x5176;&#x5B83;&#x670D;&#x52A1;&#xFF0C;&#x4E5F;&#x90FD;&#x8981;&#x5728;&#x8FD9;&#x4E2A;&#x5730;&#x65B9;&#x6DFB;&#x52A0;&#x5230;&#x670D;&#x52A1;&#x5BB9;&#x5668;&#x91CC;&#x3002;</p>
<p>&#x628A;&#x4E0B;&#x9762;&#x8FD9;&#x884C;&#x6DFB;&#x52A0;&#x5230;<code>ConfigureServices</code>&#x4E2D;&#x7684;&#x4EFB;&#x610F;&#x4F4D;&#x7F6E;&#xFF1A;</p>
<pre><code class="lang-csharp">services.AddSingleton&lt;ITodoItemService, FakeTodoItemService&gt;();
</code></pre>
<p>&#x8FD9;&#x4E00;&#x884C;&#x544A;&#x77E5; ASP.NET Core&#xFF0C;&#x5728;&#x4EFB;&#x4F55;&#x65F6;&#x5019;&#xFF0C;&#x53EA;&#x8981; <code>ITodoItemService</code> &#x88AB;&#x4E00;&#x4E2A;&#x6784;&#x9020;&#x51FD;&#x6570;&#xFF08;&#x6216;&#x5176;&#x5B83;&#x4EC0;&#x4E48;&#x5730;&#x65B9;&#xFF09;&#x88AB;&#x8BF7;&#x6C42;&#xFF0C;&#x5C31;&#x7528;&#x8FD9;&#x4E2A; <code>FakeTodoItemService</code>&#x3002;</p>
<p><code>AddSingleton</code> &#x628A;&#x4F60;&#x7684;&#x670D;&#x52A1;&#x4F5C;&#x4E3A; <strong>singleton</strong> &#x6DFB;&#x52A0;&#x8FDB;&#x670D;&#x52A1;&#x5BB9;&#x5668;&#x3002;&#x8FD9;&#x610F;&#x5473;&#x7740;&#xFF0C;&#x53EA;&#x6709;&#x4E00;&#x4E2A;<code>FakeTodoItemService</code>&#x7684;&#x5B9E;&#x4F8B;&#x88AB;&#x521B;&#x5EFA;&#xFF0C;&#x5E76;&#x5728;&#x6BCF;&#x6B21;&#x88AB;&#x8BF7;&#x6C42;&#x7684;&#x65F6;&#x5019;&#x90FD;&#x88AB;&#x590D;&#x7528;&#x3002;&#x5728;&#x540E;&#x9762;&#xFF0C;&#x5F53;&#x4F60;&#x5199;&#x53E6;&#x4E00;&#x4E2A;&#x670D;&#x52A1;&#x53BB;&#x8DDF;&#x6570;&#x636E;&#x5E93;&#x4EA4;&#x4E92;&#x65F6;&#xFF0C;&#x4F60;&#x4F1A;&#x91C7;&#x7528;&#x4E00;&#x4E2A;&#x4E0D;&#x540C;&#x7684;&#x65B9;&#x5F0F;&#xFF08;&#x53EB;&#x505A; <strong>scoped</strong>&#xFF09;&#x3002;&#x6211;&#x4F1A;&#x5728; <em>&#x8FD0;&#x7528;&#x6570;&#x636E;&#x5E93;</em> &#x4E00;&#x7AE0;&#x91CC;&#x8BF4;&#x660E;&#x539F;&#x56E0;&#x3002;</p>
<p>&#x597D;&#x4E86;&#xFF0C;&#x5F53;&#x4E00;&#x4E2A;&#x8BF7;&#x6C42;&#x8FDB;&#x6765;&#xFF0C;&#x5C06;&#x4F1A;&#x88AB;&#x53D1;&#x9001;&#x5230; <code>TodoController</code>&#xFF0C;&#x5F53;&#x63A7;&#x5236;&#x5668;&#x9700;&#x8981;&#x4E00;&#x4E2A;<code>ITodoItemService</code> &#x65F6;&#xFF0C;ASP.NET Core &#x4F1A;&#x5728; &#x53EF;&#x7528;&#x670D;&#x52A1;&#x96C6;&#x5408; &#x91CC;&#x67E5;&#x627E;&#x5E76;&#x81EA;&#x52A8;&#x7ED9;&#x51FA; <code>FakeTodoItemService</code>&#x3002;&#x56E0;&#x4E3A;&#x670D;&#x52A1;&#x662F;&#x4ECE;&#x670D;&#x52A1;&#x5BB9;&#x5668;&#x91CC;&#x201C;&#x6CE8;&#x5165;(injected)&#x201D;&#x7684;&#xFF0C;&#x8FD9;&#x4E2A;&#x6A21;&#x5F0F;&#x88AB;&#x79F0;&#x4E3A; <strong>&#x4F9D;&#x8D56;&#x6CE8;&#x5165;(dependency injection)</strong>&#x3002;</p>
<hr>
<h2 id="use-dependency-injection"><a name="use-dependency-injection" class="plugin-anchor" href="#use-dependency-injection"><i class="fa fa-link" aria-hidden="true"></i></a>Use dependency injection</h2>
<p>Back in the <code>TodoController</code>, add some code to work with the <code>ITodoItemService</code>:</p>
<pre><code class="lang-csharp"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">TodoController</span> : <span class="hljs-title">Controller</span>
{
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">readonly</span> ITodoItemService _todoItemService;

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">TodoController</span>(<span class="hljs-params">ITodoItemService todoItemService</span>)
    </span>{
        _todoItemService = todoItemService;
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> IActionResult <span class="hljs-title">Index</span>(<span class="hljs-params"></span>)
    </span>{
        <span class="hljs-comment">// Get to-do items from database</span>

        <span class="hljs-comment">// Put items into a model</span>

        <span class="hljs-comment">// Pass the view to a model and render</span>
    }
}
</code></pre>
<p>Since <code>ITodoItemService</code> is in the <code>Services</code> namespace, you&apos;ll also need to add a <code>using</code> statement at the top:</p>
<pre><code class="lang-csharp"><span class="hljs-keyword">using</span> AspNetCoreTodo.Services;
</code></pre>
<p>The first line of the class declares a private variable to hold a reference to the <code>ITodoItemService</code>. This variable lets you use the service from the <code>Index</code> action method later (you&apos;ll see how in a minute).</p>
<p>The <code>public TodoController(ITodoItemService todoItemService)</code> line defines a <strong>constructor</strong> for the class. The constructor is a special method that is called when you want to create a new instance of a class (the <code>TodoController</code> class, in this case). By adding an <code>ITodoItemService</code> parameter to the constructor, you&apos;ve declared that in order to create the <code>TodoController</code>, you&apos;ll need to provide an object that matches the <code>ITodoItemService</code> interface.</p>
<blockquote>
<p>Interfaces are awesome because they help decouple (separate) the logic of your application. Since the controller depends on the <code>ITodoItemService</code> interface, and not on any <em>specific</em> class, it doesn&apos;t know or care which class it&apos;s actually given. It could be the <code>FakeTodoItemService</code>, a different one that talks to a live database, or something else! As long as it matches the interface, the controller can use it. This makes it really easy to test parts of your application separately. I&apos;ll cover testing in detail in the <em>Automated testing</em> chapter.</p>
</blockquote>
<p>Now you can finally use the <code>ITodoItemService</code> (via the private variable you declared) in your action method to get to-do items from the service layer:</p>
<pre><code class="lang-csharp"><span class="hljs-function"><span class="hljs-keyword">public</span> IActionResult <span class="hljs-title">Index</span>(<span class="hljs-params"></span>)
</span>{
    <span class="hljs-keyword">var</span> items = <span class="hljs-keyword">await</span> _todoItemService.GetIncompleteItemsAsync();

    <span class="hljs-comment">// ...</span>
}
</code></pre>
<p>Remember that the <code>GetIncompleteItemsAsync</code> method returned a <code>Task&lt;TodoItem[]&gt;</code>? Returning a <code>Task</code> means that the method won&apos;t necessarily have a result right away, but you can use the <code>await</code> keyword to make sure your code waits until the result is ready before continuing on.</p>
<p>The <code>Task</code> pattern is common when your code calls out to a database or an API service, because it won&apos;t be able to return a real result until the database (or network) responds. If you&apos;ve used promises or callbacks in JavaScript or other languages, <code>Task</code> is the same idea: the promise that there will be a result - sometime in the future.</p>
<blockquote>
<p>If you&apos;ve had to deal with &quot;callback hell&quot; in older JavaScript code, you&apos;re in luck. Dealing with asynchronous code in .NET is much easier thanks to the magic of the <code>await</code> keyword! <code>await</code> lets your code pause on an async operation, and then pick up where it left off when the underlying database or network request finishes. In the meantime, your application isn&apos;t blocked, because it can process other requests as needed. This pattern is simple but takes a little getting used to, so don&apos;t worry if this doesn&apos;t make sense right away. Just keep following along!</p>
</blockquote>
<p>The only catch is that you need to update the <code>Index</code> method signature to return a <code>Task&lt;IActionResult&gt;</code> instead of just <code>IActionResult</code>, and mark it as <code>async</code>:</p>
<pre><code class="lang-csharp"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">async</span> Task&lt;IActionResult&gt; <span class="hljs-title">Index</span>(<span class="hljs-params"></span>)
</span>{
    <span class="hljs-keyword">var</span> items = <span class="hljs-keyword">await</span> _todoItemService.GetIncompleteItemsAsync();

    <span class="hljs-comment">// Put items into a model</span>

    <span class="hljs-comment">// Pass the view to a model and render</span>
}
</code></pre>
<p>You&apos;re almost there! You&apos;ve made the <code>TodoController</code> depend on the <code>ITodoItemService</code> interface, but you haven&apos;t yet told ASP.NET Core that you want the <code>FakeTodoItemService</code> to be the actual service that&apos;s used under the hood. It might seem obvious right now since you only have one class that implements <code>ITodoItemService</code>, but later you&apos;ll have multiple classes that implement the same interface, so being explicit is necessary.</p>
<p>Declaring (or &quot;wiring up&quot;) which concrete class to use for each interface is done in the <code>ConfigureServices</code> method of the <code>Startup</code> class. Right now, it looks something like this:</p>
<p><strong>Startup.cs</strong></p>
<pre><code class="lang-csharp"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">ConfigureServices</span>(<span class="hljs-params">IServiceCollection services</span>)
</span>{
    <span class="hljs-comment">// (... some code)</span>

    services.AddMvc();
}
</code></pre>
<p>The job of the <code>ConfigureServices</code> method is adding things to the <strong>service container</strong>, or the collection of services that ASP.NET Core knows about. The <code>services.AddMvc</code> line adds the services that the internal ASP.NET Core systems need (as an experiment, try commenting out this line). Any other services you want to use in your application must be added to the service container here in <code>ConfigureServices</code>.</p>
<p>Add the following line anywhere inside the <code>ConfigureServices</code> method:</p>
<pre><code class="lang-csharp">services.AddSingleton&lt;ITodoItemService, FakeTodoItemService&gt;();
</code></pre>
<p>This line tells ASP.NET Core to use the <code>FakeTodoItemService</code> whenever the <code>ITodoItemService</code> interface is requested in a constructor (or anywhere else).</p>
<p><code>AddSingleton</code> adds your service to the service container as a <strong>singleton</strong>. This means that only one copy of the <code>FakeTodoItemService</code> is created, and it&apos;s reused whenever the service is requested. Later, when you write a different service class that talks to a database, you&apos;ll use a different approach (called <strong>scoped</strong>) instead. I&apos;ll explain why in the <em>Use a database</em> chapter.</p>
<p>That&apos;s it! When a request comes in and is routed to the <code>TodoController</code>, ASP.NET Core will look at the available services and automatically supply the <code>FakeTodoItemService</code> when the controller asks for an <code>ITodoItemService</code>. Because the services are &quot;injected&quot; from the service container, this pattern is called <strong>dependency injection</strong>.</p>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="add-service-class.html" class="navigation navigation-prev " aria-label="Previous page: 添加一个服务类">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="finish-controller.html" class="navigation navigation-next " aria-label="Next page: 完成控制器">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"运用依赖注入","level":"1.3.5","depth":2,"next":{"title":"完成控制器","level":"1.3.6","depth":2,"path":"chapters/mvc-basics/finish-controller.md","ref":"chapters/mvc-basics/finish-controller.md","articles":[]},"previous":{"title":"添加一个服务类","level":"1.3.4","depth":2,"path":"chapters/mvc-basics/add-service-class.md","ref":"chapters/mvc-basics/add-service-class.md","articles":[]},"dir":"ltr"},"config":{"plugins":["expandable-chapters-small","disqus","splitter","anchors","copy-code-button","forkmegithub"],"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"pluginsConfig":{"disqus":{"useIdentifier":false,"shortName":"little-aspnetcore-book-cn"},"splitter":{},"search":{},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"fontsettings":{"theme":"white","family":"sans","size":2},"highlight":{},"expandable-chapters-small":{},"copy-code-button":{},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"forkmegithub":{"color":"orange","url":"https://github.com/windsting/little-aspnetcore-book"},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false},"anchors":{}},"theme":"default","author":"Nate Barbettini","pdf":{"pageNumbers":true,"fontSize":13,"fontFamily":"Microsoft YaHei","paperSize":"a5","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"variables":{},"title":"简明 ASP.NET Core 手册","language":"zh-hans","gitbook":"*","description":"一个关于“使用 ASP.NET Core 框架的构建 web 应用程序”的入门简介。"},"file":{"path":"chapters/mvc-basics/use-dependency-injection.md","mtime":"2020-12-02T18:04:53.178Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2020-12-02T18:52:41.522Z"},"basePath":"../..","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="../../gitbook/gitbook.js"></script>
    <script src="../../gitbook/theme.js"></script>
    
        
        <script src="../../gitbook/gitbook-plugin-expandable-chapters-small/expandable-chapters-small.js"></script>
        
    
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/URI.js/1.16.1/URI.min.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-disqus/plugin.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-splitter/splitter.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-copy-code-button/toggle.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-forkmegithub/plugin.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

