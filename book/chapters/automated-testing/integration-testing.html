
<!DOCTYPE HTML>
<html lang="zh-hans" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>集成测试 · 简明 ASP.NET Core 手册</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        <meta name="author" content="Nate Barbettini">
        
        
    
    <link rel="stylesheet" href="../../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-expandable-chapters-small/expandable-chapters-small.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-disqus/plugin.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-splitter/splitter.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-anchors/plugin.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-forkmegithub/plugin.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="../deploy-the-application/" />
    
    
    <link rel="prev" href="unit-testing.html" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="输入并搜索" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="../../">
            
                <a href="../../">
            
                    
                    Introduction
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="../your-first-application/">
            
                <a href="../your-first-application/">
            
                    
                    你的第一个程序
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.1" data-path="../your-first-application/get-the-sdk.html">
            
                <a href="../your-first-application/get-the-sdk.html">
            
                    
                    获取 SDK
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.2" data-path="../your-first-application/hello-world-in-csharp.html">
            
                <a href="../your-first-application/hello-world-in-csharp.html">
            
                    
                    C# 版的 Hello World
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.3" data-path="../your-first-application/create-aspnetcore-project.html">
            
                <a href="../your-first-application/create-aspnetcore-project.html">
            
                    
                    创建一个 ASP.NET Core 项目
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3" data-path="../mvc-basics/">
            
                <a href="../mvc-basics/">
            
                    
                    MVC 基础
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.1" data-path="../mvc-basics/create-controller.html">
            
                <a href="../mvc-basics/create-controller.html">
            
                    
                    创建控制器
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2" data-path="../mvc-basics/create-models.html">
            
                <a href="../mvc-basics/create-models.html">
            
                    
                    创建模型
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.3" data-path="../mvc-basics/create-view.html">
            
                <a href="../mvc-basics/create-view.html">
            
                    
                    创建视图
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.4" data-path="../mvc-basics/add-service-class.html">
            
                <a href="../mvc-basics/add-service-class.html">
            
                    
                    添加一个服务类
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.5" data-path="../mvc-basics/use-dependency-injection.html">
            
                <a href="../mvc-basics/use-dependency-injection.html">
            
                    
                    运用依赖注入
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.6" data-path="../mvc-basics/finish-controller.html">
            
                <a href="../mvc-basics/finish-controller.html">
            
                    
                    完成控制器
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.7" data-path="../mvc-basics/update-the-layout.html">
            
                <a href="../mvc-basics/update-the-layout.html">
            
                    
                    修改布局
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.4" data-path="../add-external-packages/">
            
                <a href="../add-external-packages/">
            
                    
                    添加外来软件包
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5" data-path="../use-a-database/">
            
                <a href="../use-a-database/">
            
                    
                    运用数据库
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.1" data-path="../use-a-database/connect-to-a-database.html">
            
                <a href="../use-a-database/connect-to-a-database.html">
            
                    
                    连接数据库
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.2" data-path="../use-a-database/update-context.html">
            
                <a href="../use-a-database/update-context.html">
            
                    
                    修改数据库上下文
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.3" data-path="../use-a-database/create-migration.html">
            
                <a href="../use-a-database/create-migration.html">
            
                    
                    创建变更
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.4" data-path="../use-a-database/create-service-class.html">
            
                <a href="../use-a-database/create-service-class.html">
            
                    
                    创建服务类
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.6" data-path="../add-more-features/">
            
                <a href="../add-more-features/">
            
                    
                    添加新特性
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.6.1" data-path="../add-more-features/add-todo-items.html">
            
                <a href="../add-more-features/add-todo-items.html">
            
                    
                    添加 待办事项 条目
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.2" data-path="../add-more-features/complete-with-checkbox.html">
            
                <a href="../add-more-features/complete-with-checkbox.html">
            
                    
                    使用复选框标记条目完成
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.7" data-path="../security-and-identity/">
            
                <a href="../security-and-identity/">
            
                    
                    安全和身份
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.7.1" data-path="../security-and-identity/require-authentication.html">
            
                <a href="../security-and-identity/require-authentication.html">
            
                    
                    提示认证
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.2" data-path="../security-and-identity/using-identity-in-the-application.html">
            
                <a href="../security-and-identity/using-identity-in-the-application.html">
            
                    
                    在程序中使用身份
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.3" data-path="../security-and-identity/authorization-with-roles.html">
            
                <a href="../security-and-identity/authorization-with-roles.html">
            
                    
                    按角色进行授权
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.4" data-path="../security-and-identity/more-resources.html">
            
                <a href="../security-and-identity/more-resources.html">
            
                    
                    附加资源
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.8" data-path="./">
            
                <a href="./">
            
                    
                    自动化测试
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.8.1" data-path="unit-testing.html">
            
                <a href="unit-testing.html">
            
                    
                    单元测试
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="1.8.2" data-path="integration-testing.html">
            
                <a href="integration-testing.html">
            
                    
                    集成测试
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.9" data-path="../deploy-the-application/">
            
                <a href="../deploy-the-application/">
            
                    
                    部署程序
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.9.1" data-path="../deploy-the-application/deploy-to-azure.html">
            
                <a href="../deploy-the-application/deploy-to-azure.html">
            
                    
                    部署到 Azure
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.2" data-path="../deploy-the-application/deploy-with-docker.html">
            
                <a href="../deploy-the-application/deploy-with-docker.html">
            
                    
                    使用 Docker 进行部署
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.10" data-path="../conclusion/">
            
                <a href="../conclusion/">
            
                    
                    结束语
            
                </a>
            

            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            本书使用 GitBook 发布
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="../.." >集成测试</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h2 id="&#x96C6;&#x6210;&#x6D4B;&#x8BD5;"><a name="&#x96C6;&#x6210;&#x6D4B;&#x8BD5;" class="plugin-anchor" href="#&#x96C6;&#x6210;&#x6D4B;&#x8BD5;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x96C6;&#x6210;&#x6D4B;&#x8BD5;</h2>
<p>&#x4E0E;&#x5355;&#x5143;&#x6D4B;&#x8BD5;&#x76F8;&#x6BD4;&#xFF0C;&#x96C6;&#x6210;&#x6D4B;&#x8BD5;&#x5728;&#x8303;&#x56F4;&#x4E0A;&#x5927;&#x5F97;&#x591A;&#x3002;&#x5B83;&#x68C0;&#x9A8C;&#x6574;&#x4E2A;&#x7A0B;&#x5E8F;&#x6808;&#x3002;&#x96C6;&#x6210;&#x6D4B;&#x8BD5;&#x5E76;&#x4E0D;&#x4F1A;&#x628A;&#x4E00;&#x4E2A;&#x7C7B;&#x6216;&#x7EC4;&#x4EF6;&#x9694;&#x79BB;&#x51FA;&#x6765;&#xFF0C;&#x800C;&#x662F;&#x786E;&#x4FDD;&#x4F60;&#x7A0B;&#x5E8F;&#x7684;&#x6240;&#x6709;&#x7EC4;&#x4EF6;&#x534F;&#x4F5C;&#x826F;&#x597D;&#xFF0C;&#x8FD9;&#x4E9B;&#x7EC4;&#x4EF6;&#x5305;&#x62EC;&#xFF1A;&#x8DEF;&#x7531;&#x3001;&#x63A7;&#x5236;&#x5668;&#x3001;&#x670D;&#x52A1;&#x3001;&#x6570;&#x636E;&#x5E93;&#x8BBF;&#x95EE;&#x7B49;&#x7B49;&#x3002;</p>
<p>&#x4E0E;&#x5355;&#x5143;&#x6D4B;&#x8BD5;&#x76F8;&#x6BD4;&#xFF0C;&#x96C6;&#x6210;&#x6D4B;&#x8BD5;&#x8F83;&#x6162;&#xFF0C;&#x5E76;&#x4E14;&#x6DB5;&#x76D6;&#x7684;&#x8303;&#x56F4;&#x8F83;&#x5927;&#xFF0C;&#x6240;&#x4EE5;&#xFF0C;&#x4E00;&#x822C;&#x6765;&#x8BF4;&#xFF0C;&#x4E00;&#x4E2A;&#x9879;&#x76EE;&#x4F1A;&#x6709;&#x5927;&#x91CF;&#x7684;&#x5355;&#x5143;&#x6D4B;&#x8BD5;&#x5185;&#x5BB9;&#xFF0C;&#x800C;&#x96C6;&#x6210;&#x6D4B;&#x8BD5;&#x7684;&#x5185;&#x5BB9;&#x5219;&#x5C48;&#x6307;&#x53EF;&#x6570;&#x3002;</p>
<p>&#x4E3A;&#x4E86;&#x6D4B;&#x8BD5;&#x6574;&#x4E2A;&#x7A0B;&#x5E8F;&#x6808;&#xFF08;&#x5305;&#x62EC;&#x63A7;&#x5236;&#x5668;&#x8DEF;&#x7531;&#xFF09;&#xFF0C;&#x96C6;&#x6210;&#x6D4B;&#x8BD5;&#x5F80;&#x5F80;&#x50CF;&#x7F51;&#x7EDC;&#x6D4F;&#x89C8;&#x5668;&#x90A3;&#x6837;&#x5411;&#x7A0B;&#x5E8F;&#x53D1;&#x8D77; HTTP &#x8BF7;&#x6C42;&#x3002;</p>
<p>&#x4E3A;&#x4E86;&#x7F16;&#x5199;&#x90A3;&#x79CD;&#x53D1;&#x8D77; HTTP &#x8BF7;&#x6C42;&#x7684;&#x96C6;&#x6210;&#x6D4B;&#x8BD5;&#xFF0C;&#x4F60;&#x53EF;&#x4EE5;&#x540C;&#x65F6;&#x624B;&#x52A8;&#x5F00;&#x542F;&#x7A0B;&#x5E8F;&#xFF0C;&#x5E76;&#x8FD0;&#x884C;&#x6D4B;&#x8BD5;&#x9879;&#x76EE;&#xFF0C;&#x5411; <code>http://localhost:5000</code> &#x53D1;&#x8D77;&#x8BF7;&#x6C42;&#x3002;ASP.NET Core &#x63D0;&#x4F9B;&#x4E86;&#x4E00;&#x4E2A;&#x66F4;&#x597D;&#x7684;&#x65B9;&#x5F0F;&#x6765;&#x6258;&#x7BA1;&#x7A0B;&#x5E8F;&#x8FDB;&#x884C;&#x6D4B;&#x8BD5;&#xFF0C;&#x5C31;&#x662F;&#xFF1A;&#x4F7F;&#x7528; <code>TestServer</code> &#x7C7B;&#x3002;<code>TestServer</code> &#x80FD;&#x591F;&#x5728;&#x6D4B;&#x8BD5;&#x671F;&#x95F4;&#x6258;&#x7BA1;&#x4F60;&#x7684;&#x7A0B;&#x5E8F;&#xFF0C;&#x5E76;&#x5728;&#x6D4B;&#x8BD5;&#x7ED3;&#x675F;&#x4E4B;&#x540E;&#x81EA;&#x52A8;&#x5173;&#x95ED;&#x5B83;&#x3002;</p>
<h3 id="&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x6D4B;&#x8BD5;&#x9879;&#x76EE;"><a name="&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x6D4B;&#x8BD5;&#x9879;&#x76EE;" class="plugin-anchor" href="#&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x6D4B;&#x8BD5;&#x9879;&#x76EE;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x6D4B;&#x8BD5;&#x9879;&#x76EE;</h3>
<p>&#x5982;&#x679C;&#x4F60;&#x6B64;&#x523B;&#x4F4D;&#x4E8E;&#x9879;&#x76EE;&#x76EE;&#x5F55;&#xFF0C;<code>cd</code> &#x5230;&#x4E0A;&#x4E00;&#x5C42;&#x7684; <code>AspNetCoreTodo</code> &#x76EE;&#x5F55;&#xFF0C;&#x4F7F;&#x7528;&#x4EE5;&#x4E0B;&#x547D;&#x4EE4;&#x642D;&#x5EFA;&#x4E00;&#x4E2A;&#x65B0;&#x9879;&#x76EE;:</p>
<pre><code>dotnet new xunit -o AspNetCoreTodo.IntegrationTests
</code></pre><p>&#x4F60;&#x73B0;&#x5728;&#x7684;&#x76EE;&#x5F55;&#x7ED3;&#x6784;&#x770B;&#x8D77;&#x6765;&#x5E94;&#x8BE5;&#x662F;&#x8FD9;&#x6837;&#xFF1A;</p>
<pre><code>AspNetCoreTodo/
    AspNetCoreTodo/
        AspNetCoreTodo.csproj
        Controllers/
        (etc...)

    AspNetCoreTodo.UnitTests/
        AspNetCoreTodo.UnitTests.csproj

    AspNetCoreTodo.IntegrationTests/
        AspNetCoreTodo.IntegrationTests.csproj
</code></pre><blockquote>
<p>&#x5982;&#x679C;&#x4F60;&#x613F;&#x610F;&#xFF0C;&#x53EF;&#x4EE5;&#x628A;&#x5355;&#x5143;&#x6D4B;&#x8BD5;&#x548C;&#x96C6;&#x6210;&#x6D4B;&#x8BD5;&#x653E;&#x7F6E;&#x5728;&#x540C;&#x4E00;&#x4E2A;&#x9879;&#x76EE;&#x91CC;&#x3002;&#x5BF9;&#x5927;&#x578B;&#x9879;&#x76EE;&#x800C;&#x8A00;&#xFF0C;&#x901A;&#x5E38;&#x4F1A;&#x628A;&#x5B83;&#x4EEC;&#x5206;&#x5F00;&#xFF0C;&#x4EE5;&#x4FBF;&#x4E8E;&#x5B83;&#x4EEC;&#x5404;&#x81EA;&#x72EC;&#x7ACB;&#x8FD0;&#x884C;&#x3002;</p>
</blockquote>
<p>&#x65E2;&#x7136;&#x8FD9;&#x4E2A;&#x6D4B;&#x8BD5;&#x9879;&#x76EE;&#x8981;&#x7528;&#x5230;&#x4E3B;&#x9879;&#x76EE;&#x4E2D;&#x7684;&#x7C7B;&#xFF0C;&#x4F60;&#x9700;&#x8981;&#x6DFB;&#x52A0;&#x4E00;&#x4E2A;&#x5F15;&#x7528;&#x6307;&#x5411;&#x4E3B;&#x9879;&#x76EE;&#xFF1A;</p>
<pre><code>dotnet add reference ../AspNetCoreTodo/AspNetCoreTodo.csproj
</code></pre><p>&#x8FD8;&#x9700;&#x8981;&#x6DFB;&#x52A0; NuGet &#x5305; <code>Microsoft.AspNetCore.TestHost</code>&#xFF1A;</p>
<pre><code>dotnet add package Microsoft.AspNetCore.TestHost
</code></pre><p>&#x5220;&#x9664; <code>dotnet new</code> &#x9ED8;&#x8BA4;&#x521B;&#x5EFA;&#x7684;&#x6587;&#x4EF6; <code>UnitTest1.cs</code>&#xFF0C;&#x8FD9;&#x6837;&#x4F60;&#x5C31;&#x4E3A;&#x96C6;&#x6210;&#x6D4B;&#x8BD5;&#x7684;&#x7F16;&#x5199;&#x51C6;&#x5907;&#x5C31;&#x7EEA;&#x4E86;&#x3002;</p>
<h3 id="&#x7F16;&#x5199;&#x96C6;&#x6210;&#x6D4B;&#x8BD5;"><a name="&#x7F16;&#x5199;&#x96C6;&#x6210;&#x6D4B;&#x8BD5;" class="plugin-anchor" href="#&#x7F16;&#x5199;&#x96C6;&#x6210;&#x6D4B;&#x8BD5;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x7F16;&#x5199;&#x96C6;&#x6210;&#x6D4B;&#x8BD5;</h3>
<p>&#x5728;&#x6BCF;&#x6B21;&#x96C6;&#x6210;&#x6D4B;&#x8BD5;&#x6267;&#x884C;&#x4E4B;&#x524D;&#xFF0C;&#x9700;&#x8981;&#x8FDB;&#x884C;&#x4E00;&#x4E9B;&#x914D;&#x7F6E;&#x3002;&#x4E3A;&#x514D;&#x914D;&#x7F6E;&#x76F8;&#x5173;&#x7684;&#x4EE3;&#x7801;&#x628A;&#x6D4B;&#x8BD5;&#x4EE3;&#x7801;&#x5F04;&#x7684;&#x4E71;&#x4E03;&#x516B;&#x7CDF;&#xFF0C;&#x4F60;&#x53EF;&#x4EE5;&#x628A;&#x914D;&#x7F6E;&#x76F8;&#x5173;&#x7684;&#x5185;&#x5BB9;&#x63D0;&#x53D6;&#x5230;&#x4E00;&#x4E2A;&#x72EC;&#x7ACB;&#x7684;&#x7C7B;&#x91CC;&#x3002;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x540D;&#x4E3A; <code>TestFixture</code> &#x7684;&#x7C7B;&#xFF1A;</p>
<p><strong>AspNetCoreTodo.IntegrationTests/TestFixture.cs</strong></p>
<pre><code class="lang-csharp"><span class="hljs-keyword">using</span> System;
<span class="hljs-keyword">using</span> System.Collections.Generic;
<span class="hljs-keyword">using</span> System.IO;
<span class="hljs-keyword">using</span> System.Net.Http;
<span class="hljs-keyword">using</span> Microsoft.AspNetCore.Hosting;
<span class="hljs-keyword">using</span> Microsoft.AspNetCore.TestHost;
<span class="hljs-keyword">using</span> Microsoft.Extensions.Configuration;

<span class="hljs-keyword">namespace</span> <span class="hljs-title">AspNetCoreTodo.IntegrationTests</span>
{
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">TestFixture</span> : <span class="hljs-title">IDisposable</span>  
    {
        <span class="hljs-keyword">private</span> <span class="hljs-keyword">readonly</span> TestServer _server;

        <span class="hljs-keyword">public</span> HttpClient Client { <span class="hljs-keyword">get</span>; }

        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">TestFixture</span>(<span class="hljs-params"></span>)
        </span>{
            <span class="hljs-keyword">var</span> builder = <span class="hljs-keyword">new</span> WebHostBuilder()
                .UseStartup&lt;AspNetCoreTodo.Startup&gt;()
                .ConfigureAppConfiguration((context, config) =&gt;
                {
                    config.SetBasePath(Path.Combine(
                        Directory.GetCurrentDirectory(),
                        <span class="hljs-string">&quot;..\\..\\..\\..\\AspNetCoreTodo&quot;</span>));

                    config.AddJsonFile(<span class="hljs-string">&quot;appsettings.json&quot;</span>);
                });

            _server = <span class="hljs-keyword">new</span> TestServer(builder);

            Client = _server.CreateClient();
            Client.BaseAddress = <span class="hljs-keyword">new</span> Uri(<span class="hljs-string">&quot;http://localhost:8888&quot;</span>);
        }

        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Dispose</span>(<span class="hljs-params"></span>)
        </span>{
            Client.Dispose();
            _server.Dispose();
        }
    }
}
</code></pre>
<p>&#x8FD9;&#x4E2A;&#x7C7B;&#x914D;&#x7F6E;&#x597D;&#x4E86;&#x4E00;&#x4E2A; <code>TestServer</code>&#xFF0C;&#x5E76;&#x4F7F;&#x6D4B;&#x8BD5;&#x4EE3;&#x7801;&#x5E72;&#x51C0;&#x5229;&#x7D22;&#x3002;</p>
<p>&#x73B0;&#x5728;&#x4F60;&#xFF08;&#x771F;&#x7684;&#xFF09;&#x53EF;&#x4EE5;&#x5F00;&#x59CB;&#x7F16;&#x5199;&#x96C6;&#x6210;&#x6D4B;&#x8BD5;&#x4E86;&#x3002;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x540D;&#x4E3A; <code>TodoRouteShould</code> &#x7684;&#x7C7B;&#xFF1A;</p>
<p><strong>AspNetCoreTodo.IntegrationTests/TodoRouteShould.cs</strong></p>
<pre><code class="lang-csharp">using System.Net;
using System.Net.Http;
using System.Threading.Tasks;
using Xunit;

namespace AspNetCoreTodo.IntegrationTests
{
    public class TodoRouteShould : IClassFixture&lt;TestFixture&gt;
    {
        private readonly HttpClient _client;

        public TodoRouteShould(TestFixture fixture)
        {
            _client = fixture.Client;
        }

        [Fact]
        public async Task ChallengeAnonymousUser()
        {
            // Arrange
            var request = new HttpRequestMessage(
                HttpMethod.Get, &quot;/todo&quot;);

            // Act: request the /todo route
            var response = await _client.SendAsync(request);

            // Assert: the user is sent to the login page
            Assert.Equal(
                HttpStatusCode.Redirect,
                response.StatusCode);

            Assert.Equal(
                &quot;http://localhost:8888/Account&quot; +
                &quot;/Login?ReturnUrl=%2Ftodo&quot;,
                response.Headers.Location.ToString());
        }
    }
}
</code></pre>
<p>&#x8FD9;&#x4E2A;&#x6D4B;&#x8BD5;&#x53D1;&#x8D77;&#x4E00;&#x4E2A;&#x533F;&#x540D;(&#x672A;&#x767B;&#x5F55;)&#x7684;&#x8BF7;&#x6C42;&#x5230;&#x8DEF;&#x5F84; <code>/todo</code>&#xFF0C;&#x5E76;&#x9A8C;&#x8BC1;&#x6D4F;&#x89C8;&#x5668;&#x88AB;&#x91CD;&#x5B9A;&#x5411;&#x5230;&#x4E86;&#x767B;&#x5F55;&#x9875;&#x9762;&#x3002;</p>
<p>&#x8FD9;&#x662F;&#x4E2A;&#x5F88;&#x9002;&#x5408;&#x96C6;&#x6210;&#x6D4B;&#x8BD5;&#x7684;&#x4F7F;&#x7528;&#x573A;&#x666F;&#xFF0C;&#x56E0;&#x4E3A;&#x5B83;&#x6DB5;&#x76D6;&#x4E86;&#x7A0B;&#x5E8F;&#x7684;&#x591A;&#x4E2A;&#x7EC4;&#x4EF6;&#xFF1A;&#x8DEF;&#x7531;&#x7CFB;&#x7EDF;&#x3001;&#x63A7;&#x5236;&#x5668;&#x3001;&#x63A7;&#x5236;&#x5668;&#x88AB;&#x6807;&#x8BB0;&#x4E86; <code>[Authorize]</code> &#x7B49;&#x7B49;&#x3002;&#x8FD9;&#x662F;&#x4E2A;&#x826F;&#x597D;&#x7684;&#x6D4B;&#x8BD5;&#x70B9;&#xFF0C;&#x56E0;&#x4E3A;&#x5B83;&#x786E;&#x4FDD;&#x4F60;&#x4E0D;&#x4F1A;&#x610F;&#x5916;&#x5730;&#x5F04;&#x4E22;&#x4E86; <code>[Authorize]</code> &#x5C5E;&#x6027;&#xFF0C;&#x4ECE;&#x800C;&#x5BFC;&#x81F4;&#x5F85;&#x529E;&#x4E8B;&#x9879;&#x89C6;&#x56FE;&#x5BF9;&#x6240;&#x6709;&#x4EBA;&#x53EF;&#x89C1;&#x3002;</p>
<p>&#x5728;&#x7EC8;&#x7AEF;&#x7A97;&#x53E3;&#x8FD0;&#x884C; <code>dotnet test</code>&#xFF0C;&#x5982;&#x679C;&#x4E00;&#x5207;&#x5DE5;&#x4F5C;&#x987A;&#x5229;&#xFF0C;&#x4F60;&#x4F1A;&#x770B;&#x5230;&#x8FD9;&#x6837;&#x7684;&#x6210;&#x529F;&#x4FE1;&#x606F;&#xFF1A;</p>
<pre><code>Starting test execution, please wait...
 Discovering: AspNetCoreTodo.IntegrationTests
 Discovered:  AspNetCoreTodo.IntegrationTests
 Starting:    AspNetCoreTodo.IntegrationTests
 Finished:    AspNetCoreTodo.IntegrationTests

Total tests: 1. Passed: 1. Failed: 0. Skipped: 0.
Test Run Successful.
Test execution time: 2.0588 Seconds
</code></pre><h2 id="&#x672C;&#x7AE0;&#x603B;&#x7ED3;"><a name="&#x672C;&#x7AE0;&#x603B;&#x7ED3;" class="plugin-anchor" href="#&#x672C;&#x7AE0;&#x603B;&#x7ED3;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x672C;&#x7AE0;&#x603B;&#x7ED3;</h2>
<p>&#x6D4B;&#x8BD5;&#x662F;&#x4E2A;&#x5BBD;&#x6CDB;&#x7684;&#x8BDD;&#x9898;&#xFF0C;&#x8FD8;&#x6709;&#x5F88;&#x591A;&#x4E1C;&#x897F;&#x9700;&#x8981;&#x5B66;&#x4E60;&#x3002;&#x672C;&#x7AE0;&#x8282;&#x6CA1;&#x6709;&#x6D89;&#x53CA; UI &#x6D4B;&#x8BD5;&#xFF0C;&#x4E5F;&#x6CA1;&#x6709;&#x5BF9;&#x524D;&#x7AEF;(JavaScript)&#x4EE3;&#x7801;&#x8FDB;&#x884C;&#x6D4B;&#x8BD5;&#x2014;&#x2014;&#x5B83;&#x672C;&#x8EAB;&#x53EF;&#x80FD;&#x5C31;&#x9700;&#x8981;&#x4E00;&#x6574;&#x672C;&#x4E66;&#x53BB;&#x8BB2;&#x8FF0;&#x3002;&#x4E0D;&#x8FC7;&#xFF0C;&#x4F60;&#x5E94;&#x8BE5;&#x5DF2;&#x7ECF;&#x638C;&#x63E1;&#x4E86;&#x4E00;&#x4E9B;&#x57FA;&#x672C;&#x7684;&#x6280;&#x80FD;&#x548C;&#x77E5;&#x8BC6;&#xFF0C;&#x53EF;&#x7528;&#x4E8E;&#x5B9E;&#x8DF5;&#x5E76;&#x5B66;&#x4E60;&#x66F4;&#x591A;&#x76F8;&#x5173;&#x6D4B;&#x8BD5;&#x7A0B;&#x5E8F;&#x7684;&#x7F16;&#x5199;&#x3002;</p>
<p>&#x50CF;&#x4EE5;&#x5F80;&#x4E00;&#x6837;&#xFF0C;ASP.NET Core &#x6587;&#x6863;&#xFF08;<a href="https://docs.asp.net&#xFF09;&#x548C;" target="_blank">https://docs.asp.net&#xFF09;&#x548C;</a> StackOverflow &#x90FD;&#x662F;&#x7528;&#x4E8E;&#x4E86;&#x89E3;&#x66F4;&#x591A;&#x77E5;&#x8BC6;&#x4EE5;&#x53CA;&#x9047;&#x5230;&#x95EE;&#x9898;&#x65F6;&#x67E5;&#x627E;&#x7B54;&#x6848;&#x7684;&#x597D;&#x8D44;&#x6E90;&#x3002;</p>
<hr>
<h2 id="integration-testing"><a name="integration-testing" class="plugin-anchor" href="#integration-testing"><i class="fa fa-link" aria-hidden="true"></i></a>Integration testing</h2>
<p>Compared to unit tests, integration tests are much larger in scope. exercise the whole application stack. Instead of isolating one class or method, integration tests ensure that all of the components of your application are working together properly: routing, controllers, services, database code, and so on.</p>
<p>Integration tests are slower and more involved than unit tests, so it&apos;s common for a project to have lots of small unit tests but only a handful of integration tests.</p>
<p>In order to test the whole stack (including controller routing), integration tests typically make HTTP calls to your application just like a web browser would.</p>
<p>To write integration tests that make HTTP requests, you could manually start your application and tests at the same time, and write your tests to make requests to <code>http://localhost:5000</code>. ASP.NET Core provides a nicer way to host your application for testing, however: the <code>TestServer</code> class. <code>TestServer</code> can host your application for the duration of the test, and then stop it automatically when the test is complete.</p>
<h3 id="create-a-test-project"><a name="create-a-test-project" class="plugin-anchor" href="#create-a-test-project"><i class="fa fa-link" aria-hidden="true"></i></a>Create a test project</h3>
<p>If you&apos;re currently in your project directory, <code>cd</code> up one level to the root <code>AspNetCoreTodo</code> directory. Use this command to scaffold a new test project:</p>
<pre><code>dotnet new xunit -o AspNetCoreTodo.IntegrationTests
</code></pre><p>Your directory structure should now look like this:</p>
<pre><code>AspNetCoreTodo/
    AspNetCoreTodo/
        AspNetCoreTodo.csproj
        Controllers/
        (etc...)

    AspNetCoreTodo.UnitTests/
        AspNetCoreTodo.UnitTests.csproj

    AspNetCoreTodo.IntegrationTests/
        AspNetCoreTodo.IntegrationTests.csproj
</code></pre><blockquote>
<p>If you prefer, you can keep your unit tests and integration tests in the same project. For large projects, it&apos;s common to split them up so it&apos;s easy to run them separately.</p>
</blockquote>
<p>Since the test project will use the classes defined in your main project, you&apos;ll need to add a reference to the main project:</p>
<pre><code>dotnet add reference ../AspNetCoreTodo/AspNetCoreTodo.csproj
</code></pre><p>You&apos;ll also need to add the <code>Microsoft.AspNetCore.TestHost</code> NuGet package:</p>
<pre><code>dotnet add package Microsoft.AspNetCore.TestHost
</code></pre><p>Delete the <code>UnitTest1.cs</code> file that&apos;s created by <code>dotnet new</code>. You&apos;re ready to write an integration test.</p>
<h3 id="write-an-integration-test"><a name="write-an-integration-test" class="plugin-anchor" href="#write-an-integration-test"><i class="fa fa-link" aria-hidden="true"></i></a>Write an integration test</h3>
<p>There are a few things that need to be configured on the test server before each test. Instead of cluttering the test with this setup code, you can keep this setup in a separate class. Create a new class called <code>TestFixture</code>:</p>
<p><strong>AspNetCoreTodo.IntegrationTests/TestFixture.cs</strong></p>
<pre><code class="lang-csharp"><span class="hljs-keyword">using</span> System;
<span class="hljs-keyword">using</span> System.Collections.Generic;
<span class="hljs-keyword">using</span> System.IO;
<span class="hljs-keyword">using</span> System.Net.Http;
<span class="hljs-keyword">using</span> Microsoft.AspNetCore.Hosting;
<span class="hljs-keyword">using</span> Microsoft.AspNetCore.TestHost;
<span class="hljs-keyword">using</span> Microsoft.Extensions.Configuration;

<span class="hljs-keyword">namespace</span> <span class="hljs-title">AspNetCoreTodo.IntegrationTests</span>
{
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">TestFixture</span> : <span class="hljs-title">IDisposable</span>  
    {
        <span class="hljs-keyword">private</span> <span class="hljs-keyword">readonly</span> TestServer _server;

        <span class="hljs-keyword">public</span> HttpClient Client { <span class="hljs-keyword">get</span>; }

        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">TestFixture</span>(<span class="hljs-params"></span>)
        </span>{
            <span class="hljs-keyword">var</span> builder = <span class="hljs-keyword">new</span> WebHostBuilder()
                .UseStartup&lt;AspNetCoreTodo.Startup&gt;()
                .ConfigureAppConfiguration((context, config) =&gt;
                {
                    config.SetBasePath(Path.Combine(
                        Directory.GetCurrentDirectory(),
                        <span class="hljs-string">&quot;..\\..\\..\\..\\AspNetCoreTodo&quot;</span>));

                    config.AddJsonFile(<span class="hljs-string">&quot;appsettings.json&quot;</span>);
                });

            _server = <span class="hljs-keyword">new</span> TestServer(builder);

            Client = _server.CreateClient();
            Client.BaseAddress = <span class="hljs-keyword">new</span> Uri(<span class="hljs-string">&quot;http://localhost:8888&quot;</span>);
        }

        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Dispose</span>(<span class="hljs-params"></span>)
        </span>{
            Client.Dispose();
            _server.Dispose();
        }
    }
}
</code></pre>
<p>This class takes care of setting up a <code>TestServer</code>, and will help keep the tests themselves clean and tidy.</p>
<p>Now you&apos;re (really) ready to write an integration test. Create a new class called <code>TodoRouteShould</code>:</p>
<p><strong>AspNetCoreTodo.IntegrationTests/TodoRouteShould.cs</strong></p>
<pre><code class="lang-csharp">using System.Net;
using System.Net.Http;
using System.Threading.Tasks;
using Xunit;

namespace AspNetCoreTodo.IntegrationTests
{
    public class TodoRouteShould : IClassFixture&lt;TestFixture&gt;
    {
        private readonly HttpClient _client;

        public TodoRouteShould(TestFixture fixture)
        {
            _client = fixture.Client;
        }

        [Fact]
        public async Task ChallengeAnonymousUser()
        {
            // Arrange
            var request = new HttpRequestMessage(
                HttpMethod.Get, &quot;/todo&quot;);

            // Act: request the /todo route
            var response = await _client.SendAsync(request);

            // Assert: the user is sent to the login page
            Assert.Equal(
                HttpStatusCode.Redirect,
                response.StatusCode);

            Assert.Equal(
                &quot;http://localhost:8888/Account&quot; +
                &quot;/Login?ReturnUrl=%2Ftodo&quot;,
                response.Headers.Location.ToString());
        }
    }
}
</code></pre>
<p>This test makes an anonymous (not-logged-in) request to the <code>/todo</code> route and verifies that the browser is redirected to the login page.</p>
<p>This scenario is a good candidate for an integration test, because it involves multiple components of the application: the routing system, the controller, the fact that the controller is marked with <code>[Authorize]</code>, and so on. It&apos;s also a good test because it ensures you won&apos;t ever accidentally remove the <code>[Authorize]</code> attribute and make the to-do view accessible to everyone.</p>
<h2 id="run-the-test"><a name="run-the-test" class="plugin-anchor" href="#run-the-test"><i class="fa fa-link" aria-hidden="true"></i></a>Run the test</h2>
<p>Run the test in the terminal with <code>dotnet test</code>. If everything&apos;s working right, you&apos;ll see a success message:</p>
<pre><code>Starting test execution, please wait...
 Discovering: AspNetCoreTodo.IntegrationTests
 Discovered:  AspNetCoreTodo.IntegrationTests
 Starting:    AspNetCoreTodo.IntegrationTests
 Finished:    AspNetCoreTodo.IntegrationTests

Total tests: 1. Passed: 1. Failed: 0. Skipped: 0.
Test Run Successful.
Test execution time: 2.0588 Seconds
</code></pre><h2 id="wrap-up"><a name="wrap-up" class="plugin-anchor" href="#wrap-up"><i class="fa fa-link" aria-hidden="true"></i></a>Wrap up</h2>
<p>Testing is a broad topic, and there&apos;s much more to learn. This chapter doesn&apos;t touch on UI testing or testing frontend (JavaScript) code, which probably deserve entire books of their own. You should, however, have the skills and base knowledge you need to learn more about testing and to practice writing tests for your own applications.</p>
<p>The ASP.NET Core documentation (<a href="https://docs.asp.net" target="_blank">https://docs.asp.net</a>) and Stack Overflow are great resources for learning more and finding answers when you get stuck.</p>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="unit-testing.html" class="navigation navigation-prev " aria-label="Previous page: 单元测试">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="../deploy-the-application/" class="navigation navigation-next " aria-label="Next page: 部署程序">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"集成测试","level":"1.8.2","depth":2,"next":{"title":"部署程序","level":"1.9","depth":1,"path":"chapters/deploy-the-application/README.md","ref":"chapters/deploy-the-application/README.md","articles":[{"title":"部署到 Azure","level":"1.9.1","depth":2,"path":"chapters/deploy-the-application/deploy-to-azure.md","ref":"chapters/deploy-the-application/deploy-to-azure.md","articles":[]},{"title":"使用 Docker 进行部署","level":"1.9.2","depth":2,"path":"chapters/deploy-the-application/deploy-with-docker.md","ref":"chapters/deploy-the-application/deploy-with-docker.md","articles":[]}]},"previous":{"title":"单元测试","level":"1.8.1","depth":2,"path":"chapters/automated-testing/unit-testing.md","ref":"chapters/automated-testing/unit-testing.md","articles":[]},"dir":"ltr"},"config":{"plugins":["expandable-chapters-small","disqus","splitter","anchors","copy-code-button","forkmegithub"],"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"pluginsConfig":{"disqus":{"useIdentifier":false,"shortName":"little-aspnetcore-book-cn"},"splitter":{},"search":{},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"fontsettings":{"theme":"white","family":"sans","size":2},"highlight":{},"expandable-chapters-small":{},"copy-code-button":{},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"forkmegithub":{"color":"orange","url":"https://github.com/windsting/little-aspnetcore-book"},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false},"anchors":{}},"theme":"default","author":"Nate Barbettini","pdf":{"pageNumbers":true,"fontSize":13,"fontFamily":"Microsoft YaHei","paperSize":"a5","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"variables":{},"title":"简明 ASP.NET Core 手册","language":"zh-hans","gitbook":"*","description":"一个关于“使用 ASP.NET Core 框架的构建 web 应用程序”的入门简介。"},"file":{"path":"chapters/automated-testing/integration-testing.md","mtime":"2018-06-04T02:16:22.766Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2018-06-04T02:39:21.580Z"},"basePath":"../..","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="../../gitbook/gitbook.js"></script>
    <script src="../../gitbook/theme.js"></script>
    
        
        <script src="../../gitbook/gitbook-plugin-expandable-chapters-small/expandable-chapters-small.js"></script>
        
    
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/URI.js/1.16.1/URI.min.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-disqus/plugin.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-splitter/splitter.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-copy-code-button/toggle.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-forkmegithub/plugin.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

